import{p as e,a as n,o as a,c as t,w as s,b as i,F as l,r as o,t as g,d as u,v as r,e as p,s as c,f as d,g as m,h as f,i as h,j as b,V as v,k as y,l as C,m as I,n as w,q as k,u as U,x as j}from"./vendor.e2f42976.js";!function(e=".",n="__import__"){try{self[n]=new Function("u","return import(u)")}catch(a){const t=new URL(e,location),s=e=>{URL.revokeObjectURL(e.src),e.remove()};self[n]=e=>new Promise(((a,i)=>{const l=new URL(e,t);if(self[n].moduleMap[l])return a(self[n].moduleMap[l]);const o=new Blob([`import * as m from '${l}';`,`${n}.moduleMap['${l}']=m;`],{type:"text/javascript"}),g=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(o),onerror(){i(new Error(`Failed to import: ${e}`)),s(g)},onload(){a(self[n].moduleMap[l]),s(g)}});document.head.appendChild(g)})),self[n].moduleMap={}}}("https:/lenna.app/assets/");const _={name:"Navbar"},P=s();e("data-v-ab18332e");const L={class:"navbar"},R=i("a",{href:"/"},"Home",-1),F=i("a",{href:"https://github.com/lenna-project"},"Github",-1);n();const M=P(((e,n,s,i,l,o)=>(a(),t("div",L,[R,F]))));_.render=M,_.__scopeId="data-v-ab18332e";var E={name:"PluginConfig",props:{defaultConfig:Object},data:()=>({config:[]}),methods:{async updateConfig(){let e={};for(let n of this.config)e[n.key]=n.value;this.$emit("changeConfig",e)}},created(){for(let e in this.defaultConfig){let n={key:e,value:this.defaultConfig[e]};this.config.push(n)}this.updateConfig()}};const O=s();e("data-v-232092e2");const $={key:0,class:"plugin-config"};n();const V=O(((e,n,s,c,d,m)=>d.config?(a(),t("div",$,[(a(!0),t(l,null,o(d.config,(e=>(a(),t("div",{key:e.key},[i("label",null,g(e.key)+": ",1),u(i("input",{type:"number",placeholder:e.key,"onUpdate:modelValue":n=>e.value=n,onChange:n[1]||(n[1]=e=>m.updateConfig())},null,40,["placeholder","onUpdate:modelValue"]),[[r,e.value,void 0,{number:!0}]])])))),128))])):p("",!0)));E.render=V,E.__scopeId="data-v-232092e2";var x={name:"Plugin",props:{name:String,plugin:Object},components:{PluginConfig:E},data:()=>({ui:c(null),processor:null,enabled:!1,keyCounter:0,pluginKey:"",defaultConfig:null}),methods:{async loadDefaultConfig(){this.plugin.defaultConfig().then((e=>{this.defaultConfig=e}))},async loadUI(){System.import(this.name).then((e=>{e.ui&&(this.ui=i(e.ui))}))},async updateConfig(e){this.$emit("changeConfig",e)},async updateEnabled(e){this.$emit("changeEnabled",e)}},created(){this.loadUI(),this.loadDefaultConfig()},watch:{defaultConfig:{handler:function(e){this.keyCounter+=1,this.pluginKey=this.name+this.keyCounter}}}};const A=s();e("data-v-280eea0d");const D={key:0,class:"plugin"},K={for:"checkbox"},S={key:0},Z={key:0},B={key:1};n();const N=A(((e,n,s,l,o,r)=>{const c=d("PluginConfig");return s.plugin?(a(),t("div",D,[i("h1",null,[u(i("input",{type:"checkbox",id:"checkbox","onUpdate:modelValue":n[1]||(n[1]=e=>o.enabled=e),onChange:n[2]||(n[2]=e=>r.updateEnabled(o.enabled))},null,544),[[m,o.enabled]]),i("label",K,g(s.plugin.name()),1)]),f(" "+g(s.plugin.description())+" ",1),o.enabled?(a(),t("div",S,[o.ui&&o.defaultConfig?(a(),t("div",Z,[(a(),t(h(o.ui),{key:o.pluginKey,defaultConfig:o.defaultConfig,onChangeConfig:n[3]||(n[3]=e=>r.updateConfig(e))},null,8,["defaultConfig"]))])):(a(),t("div",B,[i(c,{key:o.pluginKey,defaultConfig:o.defaultConfig,onChangeConfig:n[4]||(n[4]=e=>r.updateConfig(e))},null,8,["defaultConfig"])]))])):p("",!0)])):p("",!0)}));x.render=N,x.__scopeId="data-v-280eea0d";const q=b({name:"PluginsManager",props:{pluginsmap:String},components:{Plugin:x,draggable:v},data:()=>({plugins:[]}),beforeMount(){this.getPluginsmap()},methods:{changeEnabled(e,n){this.plugins.find((n=>n.name===e)).enabled=n},changeConfig(e,n){this.plugins.find((n=>n.name===e)).config=n},raw:e=>e,async getPluginsmap(){const e=await fetch(this.pluginsmap),n=await e.json();for(const a in n.imports)System.import(a).then((e=>{this.plugins.push({name:a,url:n.imports[a],plugin:e,enabled:!1,config:{}})}))}}}),z={class:"plugins-manager"};q.render=function(e,n,s,g,u,r){const p=d("Plugin"),c=d("draggable");return a(),t("div",z,[i(c,{class:"dragArea list-group w-full",list:e.plugins},{default:y((()=>[(a(!0),t(l,null,o(e.plugins,(n=>(a(),t("div",{class:"list-group-item",key:n.name},[i(p,{name:n.name,plugin:n.plugin,onChangeEnabled:a=>e.changeEnabled(n.name,a),onChangeConfig:a=>e.changeConfig(n.name,a)},null,8,["name","plugin","onChangeEnabled","onChangeConfig"])])))),128))])),_:1},8,["list"])])};var G=b({components:{FileUpload:C},data:()=>({files:[],image:null}),methods:{inputFile(e,n,a){this.image=e,this.$emit("changeImage",e)},inputFilter(e,n,a){if(e&&!n&&!/\.(gif|jpg|jpeg|png|webp)$/i.test(e.name))return this.alert("Your choice is not a picture"),a();if(e&&(!n||e.file!==n.file)){e.url="";let n=window.URL||window.webkitURL;n&&n.createObjectURL&&(e.url=n.createObjectURL(e.file))}}}});const H=s();e("data-v-03edc14d");const Y={class:"image-upload"},J=i("h3",null,"Drop or select files",-1);n();const Q=H(((e,n,s,l,o,g)=>{const u=d("FileUpload");return a(),t("div",Y,[i(u,{multiple:!0,drop:!0,"drop-directory":!0,extensions:"gif,jpg,jpeg,png,webp",accept:"image/png,image/gif,image/jpeg,image/webp",modelValue:e.files,"onUpdate:modelValue":n[1]||(n[1]=n=>e.files=n),onInputFilter:e.inputFilter,onInputFile:e.inputFile,ref:"upload",class:"file-upload"},{default:H((()=>[J])),_:1},8,["modelValue","onInputFilter","onInputFile"]),e.image?(a(),t("img",{key:0,src:e.image.url,width:"250",height:"250"},null,8,["src"])):p("",!0)])}));G.render=Q,G.__scopeId="data-v-03edc14d";var T={props:{images:Array},methods:{createObjectURL:e=>URL.createObjectURL(e),async downloadZip(){let e=new I;this.images.forEach(((n,a)=>{e.file(`image${a}.png`,n)})),e.generateAsync({type:"blob"}).then((function(e){w.saveAs(e,"images.zip")}))}}};const W=s();e("data-v-89728f7a");const X={key:0,class:"image-preview"},ee=i("br",null,null,-1);n();const ne=W(((e,n,s,g,u,r)=>s.images.length>0?(a(),t("div",X,[i("button",{onClick:n[1]||(n[1]=(...e)=>r.downloadZip&&r.downloadZip(...e))},"Download as ZIP"),ee,(a(!0),t(l,null,o(s.images,((e,n)=>(a(),t("div",{key:n},[i("img",{src:r.createObjectURL(e)},null,8,["src"])])))),128))])):p("",!0)));T.render=ne,T.__scopeId="data-v-89728f7a";var ae=b({name:"App",components:{Navbar:_,PluginsManager:q,ImageUpload:G,ImagePreview:T},data:()=>({resultImage:null,sourceImage:null,sourceImages:[],resultImages:[]}),setup:()=>({pluginsManager:k(null)}),methods:{changeImages(e){this.sourceImage=e.file,this.sourceImages.push(this.sourceImage)},async processImages(){this.resultImages=[];for(let e of this.sourceImages)this.process(e).then((e=>{this.resultImage=e,this.resultImages.push(e)}));this.sourceImage=null,this.sourceImages=[]},async process(e){U.configure({parent:"#process"}),U.start();let n=new Uint8Array(await e.arrayBuffer());for(let t in this.pluginsManager.plugins){U.inc(.2);let e=this.pluginsManager.plugins[t];e.enabled&&(n=await e.plugin.process(e.config,n))}const a=new Blob([n],{type:"image/png"});return U.done(),U.remove(),a}}});const te=s();e("data-v-0253e9f6");const se={class:"main"},ie={id:"process"};n();const le=te(((e,n,s,o,g,u)=>{const r=d("Navbar"),c=d("ImageUpload"),m=d("PluginsManager"),f=d("ImagePreview");return a(),t(l,null,[i(r),i("div",se,[i(c,{onChangeImage:n[1]||(n[1]=n=>e.changeImages(n))}),i("div",ie,[e.sourceImage?(a(),t("button",{key:0,onClick:n[2]||(n[2]=(...n)=>e.processImages&&e.processImages(...n))}," >>process image>> ")):p("",!0),i(m,{ref:"pluginsManager",pluginsmap:"https://lenna.app/lenna-plugins/importmap.json"},null,512)]),i(f,{images:e.resultImages},null,8,["images"])])],64)}));ae.render=le,ae.__scopeId="data-v-0253e9f6";j(ae).mount("#app");
